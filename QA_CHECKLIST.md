# QA Checklist - Owner Cabinet

## Авторизация
- [ ] Команда `/cabinet` в Telegram возвращает кнопку "Открыть кабинет"
- [ ] Клик по кнопке открывает owner-web и автоматически логинит
- [ ] Cookie `owner_session` устанавливается после входа
- [ ] `/api/core/owner/auth/me` возвращает profile + bots + csrfToken
- [ ] Повторное использование той же botlink ссылки → ошибка "уже использована"
- [ ] Токен старше 2 минут → ошибка "истек"
- [ ] Пользователь без bot_admins → 403 "нет доступа"

## Multi-Bot
- [ ] Bot selector отображает все доступные боты
- [ ] Поиск в bot selector работает
- [ ] Роли отображаются корректно (owner/admin/staff/viewer)
- [ ] Переключение бота сохраняет lastBotId в localStorage
- [ ] При входе редирект на последний бот (если доступен)
- [ ] Если последний бот недоступен → редирект на первый доступный
- [ ] URL всегда содержит botId: `/cabinet/[botId]/...`
- [ ] Все запросы используют botId из route params

## Навигация
- [ ] Sidebar отображает все разделы на русском
- [ ] Активный раздел подсвечивается
- [ ] Переход между разделами работает
- [ ] Breadcrumb показывает "Боты / <Бот> / <Раздел>"
- [ ] Hotkey `/` фокусирует глобальный поиск
- [ ] Hotkey `g i` → Inbox
- [ ] Hotkey `g c` → Customers
- [ ] Hotkey `g o` → Orders
- [ ] Hotkey `g k` → Calendar
- [ ] Command Palette (⌘K) открывается
- [ ] Поиск в Command Palette работает
- [ ] Навигация из Command Palette работает

## Страницы

### Overview
- [ ] KPI карточки отображаются (лиды, заказы, выручка, конверсия)
- [ ] Недавние лиды показываются
- [ ] Недавние заказы показываются
- [ ] Ближайшие записи показываются
- [ ] Skeleton loading работает
- [ ] Empty state при отсутствии данных

### Inbox
- [ ] Список событий отображается
- [ ] Фильтры по статусу работают (new/in_progress/done/cancelled)
- [ ] Поиск работает
- [ ] Пагинация работает (cursor-based)
- [ ] Empty state при отсутствии событий

### Orders
- [ ] Список заказов отображается
- [ ] Статусы заказов показываются
- [ ] Пагинация работает
- [ ] Empty state при отсутствии заказов

### Leads
- [ ] Список лидов отображается
- [ ] Статусы лидов показываются
- [ ] Пагинация работает
- [ ] Empty state при отсутствии лидов

### Customers
- [ ] Список клиентов отображается
- [ ] Контакты (телефон/email) показываются
- [ ] Пагинация работает
- [ ] Empty state при отсутствии клиентов

### Calendar
- [ ] Записи отображаются
- [ ] Даты форматируются корректно
- [ ] Empty state при отсутствии записей

### Team
- [ ] Список участников отображается
- [ ] Роли показываются
- [ ] Empty state при отсутствии участников

### Settings
- [ ] Настройки бота отображаются
- [ ] Редактирование работает (если есть права)

### Audit
- [ ] История изменений отображается
- [ ] Сортировка по дате работает
- [ ] Empty state при отсутствии записей

## UI/UX
- [ ] Все тексты на русском (кроме общепринятых терминов)
- [ ] Skeleton loading на всех страницах
- [ ] Empty states красивые и информативные
- [ ] Ошибки показывают request_id (скрыто в "подробнее")
- [ ] Таблицы читаемые, плотные
- [ ] Badges для статусов/ролей
- [ ] Hover states работают
- [ ] Dark mode работает (если включен)
- [ ] Мобильная адаптивность (базовая)

## Безопасность
- [ ] Cookies: httpOnly, secure (prod), sameSite=Lax
- [ ] CSRF: Mutations требуют x-csrf-token
- [ ] RBAC: Нет доступа к чужим ботам → 403
- [ ] Botlink: Одноразовость через Redis
- [ ] Security headers: X-Content-Type-Options, Referrer-Policy
- [ ] Request ID в всех ответах
- [ ] Логи без токенов/паролей

## Производительность
- [ ] Страницы загружаются быстро (<2s)
- [ ] Пагинация работает без лагов
- [ ] Поиск не блокирует UI
- [ ] Skeleton показывается мгновенно

## Ошибки
- [ ] 401 → редирект на /login
- [ ] 403 → понятное сообщение
- [ ] 404 → понятное сообщение
- [ ] 500 → сообщение с request_id
- [ ] Network errors обрабатываются
- [ ] Все ошибки показывают request_id

## Интеграция
- [ ] Proxy `/api/core/*` работает
- [ ] Set-Cookie headers форвардятся
- [ ] Content-Type форвардится
- [ ] Debug header x-proxy-upstream присутствует
- [ ] Все запросы через same-origin proxy

## Финальная проверка
- [ ] Все страницы открываются без ошибок
- [ ] Нет console errors в браузере
- [ ] Нет TypeScript errors
- [ ] Нет lint errors
- [ ] Деплой на Vercel проходит успешно
- [ ] Production работает стабильно

