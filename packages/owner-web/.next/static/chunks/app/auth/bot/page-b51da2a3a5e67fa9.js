(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[651],{16144:(e,t,n)=>{"use strict";n.d(t,{CK:()=>h,D6:()=>y,FO:()=>u,Kj:()=>p,Lu:()=>c,SJ:()=>m,qf:()=>d,w1:()=>b});var a=n(13305);let r="/api/core",s=null,o=a.Ik({user:a.Ik({telegramUserId:a.ai(),username:a.Yj().nullable().optional(),firstName:a.Yj().nullable().optional(),lastName:a.Yj().nullable().optional(),photoUrl:a.Yj().nullable().optional()}),bots:a.YO(a.Ik({botId:a.Yj(),name:a.Yj(),role:a.Yj()})),csrfToken:a.Yj()});async function l(e,t){let n="undefined"!=typeof AbortController?new AbortController:null,a=n?setTimeout(()=>n.abort(),3e3):null;try{let r=await fetch(e,{...t,signal:null==n?void 0:n.signal,credentials:"include",headers:{"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}},cache:"no-store"});a&&clearTimeout(a);let s=await r.json().catch(()=>({}));if(!r.ok)throw{code:(null==s?void 0:s.code)||"request_failed",message:(null==s?void 0:s.message)||"Ошибка запроса",request_id:null==s?void 0:s.request_id,details:null==s?void 0:s.details};return s}catch(e){if(a&&clearTimeout(a),(null==e?void 0:e.name)==="AbortError")throw{code:"timeout",message:"Request timeout (3000ms)"};throw e}}function i(e){return e.startsWith("/api/core/")?e:e.startsWith("/api/")?e.replace(/^\/api\//,"/api/core/"):e.startsWith("/")?"".concat(r).concat(e):"".concat(r,"/").concat(e)}function u(e){return l(i("/api/owner/auth/telegram"),{method:"POST",body:JSON.stringify(e)})}function c(e){return l(i("/api/owner/auth/botlink"),{method:"POST",body:JSON.stringify({token:e})})}async function d(){let e=await l(i("/api/owner/auth/me")),t=o.parse(e);return s=t.csrfToken,t}function m(){return l(i("/api/owner/auth/logout"),{method:"POST"})}async function f(){if(s)return s;try{return(await d()).csrfToken||null}catch(e){return null}}async function h(e,t){let n=(null==t?void 0:t.method)||"GET",a={};if("GET"!==n){let e=(null==t?void 0:t.csrfToken)||await f();e&&(a["x-csrf-token"]=e)}return l(i(e),{method:n,headers:a,body:(null==t?void 0:t.body)!==void 0?JSON.stringify(t.body):void 0})}async function b(){return l(i("/api/owner/summary"))}async function p(){return l(i("/api/owner/bots"))}async function y(e){return l(i("/api/owner/bots/".concat(e)),{method:"DELETE"})}},62942:(e,t,n)=>{Promise.resolve().then(n.bind(n,89288))},86804:(e,t,n)=>{"use strict";var a=n(41764);n.o(a,"useParams")&&n.d(t,{useParams:function(){return a.useParams}}),n.o(a,"usePathname")&&n.d(t,{usePathname:function(){return a.usePathname}}),n.o(a,"useRouter")&&n.d(t,{useRouter:function(){return a.useRouter}}),n.o(a,"useSearchParams")&&n.d(t,{useSearchParams:function(){return a.useSearchParams}})},89288:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u,dynamic:()=>l});var a=n(33931),r=n(16144),s=n(86804),o=n(51259);let l="force-dynamic";function i(){let e=(0,s.useSearchParams)(),t=(0,s.useRouter)(),[n,l]=(0,o.useState)(null),[i,u]=(0,o.useState)(!0);return(0,o.useEffect)(()=>{let n=e.get("token");if(!n){l("Ссылка входа некорректна. Вернитесь в Telegram и отправьте /cabinet."),u(!1);return}let a=!1;return(async()=>{try{if(await (0,r.Lu)(n),a)return;t.replace("/cabinet")}catch(e){if(a)return;l((null==e?void 0:e.code)?"botlink_used"===e.code?"Эта ссылка уже использована. Откройте Telegram и снова отправьте /cabinet.":"botlink_expired"===e.code?"Срок действия ссылки истек. Откройте Telegram и снова отправьте /cabinet.":"no_bots_access"===e.code?"У вас нет доступа к кабинетам. Обратитесь к владельцу бота для выдачи прав.":e.message||"Не удалось выполнить вход. Попробуйте снова через /cabinet.":"Не удалось выполнить вход. Попробуйте снова через /cabinet."),u(!1)}})(),()=>{a=!0}},[t,e]),(0,a.jsxs)(a.Fragment,{children:[i?(0,a.jsx)("p",{className:"muted mt-3",children:"Проверяем ссылку входа..."}):null,n?(0,a.jsx)("div",{className:"mt-4 text-sm text-red-500",children:n}):null,i?null:(0,a.jsxs)("p",{className:"muted mt-4 text-sm",children:["Вернитесь в Telegram, отправьте команду ",(0,a.jsx)("b",{children:"/cabinet"})," и откройте новую ссылку."]})]})}function u(){return(0,a.jsx)("main",{className:"min-h-screen flex items-center justify-center p-6",children:(0,a.jsxs)("div",{className:"panel w-full max-w-xl p-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Вход в Owner Cabinet"}),(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)("p",{className:"muted mt-3",children:"Загрузка..."}),children:(0,a.jsx)(i,{})})]})})}}},e=>{e.O(0,[305,765,337,358],()=>e(e.s=62942)),_N_E=e.O()}]);