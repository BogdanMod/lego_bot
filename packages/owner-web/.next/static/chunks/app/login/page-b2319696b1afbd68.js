(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{16144:(e,t,n)=>{"use strict";n.d(t,{CK:()=>f,D6:()=>w,FO:()=>i,Kj:()=>b,Lu:()=>c,SJ:()=>m,qf:()=>d,w1:()=>p});var r=n(13305);let a="/api/core",s=null,o=r.Ik({user:r.Ik({telegramUserId:r.ai(),username:r.Yj().nullable().optional(),firstName:r.Yj().nullable().optional(),lastName:r.Yj().nullable().optional(),photoUrl:r.Yj().nullable().optional()}),bots:r.YO(r.Ik({botId:r.Yj(),name:r.Yj(),role:r.Yj()})),csrfToken:r.Yj()});async function l(e,t){let n="undefined"!=typeof AbortController?new AbortController:null,r=n?setTimeout(()=>n.abort(),3e3):null;try{let a=await fetch(e,{...t,signal:null==n?void 0:n.signal,credentials:"include",headers:{"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}},cache:"no-store"});r&&clearTimeout(r);let s=await a.json().catch(()=>({}));if(!a.ok)throw{code:(null==s?void 0:s.code)||"request_failed",message:(null==s?void 0:s.message)||"Ошибка запроса",request_id:null==s?void 0:s.request_id,details:null==s?void 0:s.details};return s}catch(e){if(r&&clearTimeout(r),(null==e?void 0:e.name)==="AbortError")throw{code:"timeout",message:"Request timeout (3000ms)"};throw e}}function u(e){return e.startsWith("/api/core/")?e:e.startsWith("/api/")?e.replace(/^\/api\//,"/api/core/"):e.startsWith("/")?"".concat(a).concat(e):"".concat(a,"/").concat(e)}function i(e){return l(u("/api/owner/auth/telegram"),{method:"POST",body:JSON.stringify(e)})}function c(e){return l(u("/api/owner/auth/botlink"),{method:"POST",body:JSON.stringify({token:e})})}async function d(){let e=await l(u("/api/owner/auth/me")),t=o.parse(e);return s=t.csrfToken,t}function m(){return l(u("/api/owner/auth/logout"),{method:"POST"})}async function h(){if(s)return s;try{return(await d()).csrfToken||null}catch(e){return null}}async function f(e,t){let n=(null==t?void 0:t.method)||"GET",r={};if("GET"!==n){let e=(null==t?void 0:t.csrfToken)||await h();e&&(r["x-csrf-token"]=e)}return l(u(e),{method:n,headers:r,body:(null==t?void 0:t.body)!==void 0?JSON.stringify(t.body):void 0})}async function p(){return l(u("/api/owner/summary"))}async function b(){return l(u("/api/owner/bots"))}async function w(e){return l(u("/api/owner/bots/".concat(e)),{method:"DELETE"})}},45375:(e,t,n)=>{Promise.resolve().then(n.bind(n,82465))},82465:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>u});var r=n(33931),a=n(16144),s=n(86804),o=n(51259),l=n(37811);function u(){let e=(0,s.useRouter)(),t=(0,o.useRef)(null),[n,u]=(0,o.useState)(null);return(0,o.useEffect)(()=>{var n;window.onTelegramAuth=async t=>{try{await (0,a.FO)(t),e.push("/cabinet")}catch(e){u((null==e?void 0:e.message)||"Ошибка входа")}};let r=document.createElement("script");return r.async=!0,r.src="https://telegram.org/js/telegram-widget.js?22",r.setAttribute("data-telegram-login",l.env.NEXT_PUBLIC_TELEGRAM_BOT_USERNAME||""),r.setAttribute("data-size","large"),r.setAttribute("data-onauth","onTelegramAuth(user)"),r.setAttribute("data-request-access","write"),null==(n=t.current)||n.appendChild(r),()=>{window.onTelegramAuth=void 0}},[e]),(0,r.jsx)("main",{className:"min-h-screen flex items-center justify-center p-6",children:(0,r.jsxs)("div",{className:"panel w-full max-w-xl p-8",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold",children:"Owner Cabinet"}),(0,r.jsx)("p",{className:"muted mt-2",children:"Вход без пароля через Telegram"}),(0,r.jsx)("div",{ref:t,className:"mt-6"}),(0,r.jsxs)("div",{className:"mt-4 rounded-lg border border-border p-3 text-sm muted",children:["Альтернативный вход: откройте Telegram-бота и отправьте команду ",(0,r.jsx)("b",{children:"/cabinet"}),"."]}),n?(0,r.jsx)("div",{className:"mt-4 text-sm text-red-500",children:n}):null]})})}},86804:(e,t,n)=>{"use strict";var r=n(41764);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})}},e=>{e.O(0,[305,765,337,358],()=>e(e.s=45375)),_N_E=e.O()}]);