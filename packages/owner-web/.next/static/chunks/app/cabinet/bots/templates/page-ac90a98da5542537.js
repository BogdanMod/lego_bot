(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[924],{16144:(e,t,r)=>{"use strict";r.d(t,{CK:()=>p,D6:()=>b,FO:()=>u,HP:()=>v,JD:()=>x,Kj:()=>f,Lu:()=>c,SJ:()=>m,qf:()=>d,w1:()=>g});var a=r(13305);let n="/api/core",s=null,l=a.Ik({user:a.Ik({telegramUserId:a.ai(),username:a.Yj().nullable().optional(),firstName:a.Yj().nullable().optional(),lastName:a.Yj().nullable().optional(),photoUrl:a.Yj().nullable().optional()}),bots:a.YO(a.Ik({botId:a.Yj(),name:a.Yj(),role:a.Yj()})),csrfToken:a.Yj()});async function o(e,t){let r="undefined"!=typeof AbortController?new AbortController:null,a=r?setTimeout(()=>r.abort(),3e3):null;try{let n=await fetch(e,{...t,signal:null==r?void 0:r.signal,credentials:"include",headers:{"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}},cache:"no-store"});a&&clearTimeout(a);let l=await n.json().catch(()=>({}));if(!n.ok){let e=(null==l?void 0:l.message)||"Ошибка запроса",t=(null==l?void 0:l.code)||"request_failed";if("proxy_misconfigured"===t||e.includes("CORE_API_ORIGIN"))e="CORE_API_ORIGIN не настроен. Проверьте переменные окружения в Railway.";else if("misconfigured"===t&&e.includes("Owner auth is not configured")){let t=e.match(/missing ([^,]+(?:, [^,]+)*)/);e=t?"Owner auth не настроен: отсутствуют ".concat(t[1],". Проверьте переменные окружения в сервисе core."):"Owner auth не настроен. Проверьте JWT_SECRET и TELEGRAM_BOT_TOKEN в сервисе core."}if("csrf_failed"===t||"csrf_token_mismatch"===t){s=null;try{s=(await d()).csrfToken||null,e="CSRF токен обновлен. Попробуйте еще раз."}catch(t){e="Ошибка CSRF токена. Обновите страницу."}}else(401===n.status||403===n.status)&&("unauthorized"===t||"invalid_telegram_auth"===t)&&(e=e||"Требуется авторизация. Войдите через Telegram.");throw{code:t,message:e,request_id:null==l?void 0:l.request_id,details:null==l?void 0:l.details}}return l}catch(e){if(a&&clearTimeout(a),(null==e?void 0:e.name)==="AbortError")throw{code:"timeout",message:"Request timeout (3000ms)"};throw e}}function i(e){return e.startsWith("/api/core/")?e:e.startsWith("/api/")?e.replace(/^\/api\//,"/api/core/"):e.startsWith("/")?"".concat(n).concat(e):"".concat(n,"/").concat(e)}function u(e){return o(i("/api/owner/auth/telegram"),{method:"POST",body:JSON.stringify(e)})}function c(e,t){return o(i("/api/owner/auth/botlink"),{method:"POST",body:JSON.stringify({token:e,...t?{next:t}:{}})})}async function d(){let e=await o(i("/api/owner/auth/me")),t=l.parse(e);return s=t.csrfToken,t}function m(){return o(i("/api/owner/auth/logout"),{method:"POST"})}async function h(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(s&&!e)return s;try{return s=(await d()).csrfToken||null}catch(e){return s=null,null}}async function p(e,t){let r=(null==t?void 0:t.method)||"GET",a={};if("GET"!==r){let e=(null==t?void 0:t.csrfToken)||await h();e&&(a["x-csrf-token"]=e)}return o(i(e),{method:r,headers:a,body:(null==t?void 0:t.body)!==void 0?JSON.stringify(t.body):void 0})}async function g(){return o(i("/api/owner/summary"))}async function f(){return o(i("/api/owner/bots"))}async function b(e){return console.log(JSON.stringify({action:"owner_deactivate_bot",botId:e,timestamp:new Date().toISOString()})),await h(),p("/api/owner/bots/".concat(e),{method:"DELETE"})}async function x(){return p("/api/owner/templates")}async function v(e){return p("/api/owner/bots",{method:"POST",body:e})}},86804:(e,t,r)=>{"use strict";var a=r(41764);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},97527:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var a=r(33931),n=r(86804),s=r(51259),l=r(30883),o=r(16144);let i=["Все","Бизнес","Образование","Развлечения","Другое"];function u(){let e=(0,n.useRouter)(),[t,r]=(0,s.useState)(""),[u,d]=(0,s.useState)("Все"),{data:m,isLoading:h,error:p}=(0,l.I)({queryKey:["owner-templates"],queryFn:o.JD}),g=(0,s.useMemo)(()=>{if(!(null==m?void 0:m.items))return[];let e=m.items;if("Все"!==u&&(e=e.filter(e=>e.industry===u)),t.trim()){let r=t.toLowerCase();e=e.filter(e=>e.title.toLowerCase().includes(r)||e.goal.toLowerCase().includes(r)||e.tags.some(e=>e.toLowerCase().includes(r)))}return e},[null==m?void 0:m.items,u,t]);return h?(0,a.jsx)("div",{className:"panel p-8",children:(0,a.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,a.jsx)("div",{className:"h-8 bg-slate-200 dark:bg-slate-700 rounded w-1/4"}),(0,a.jsx)("div",{className:"h-10 bg-slate-200 dark:bg-slate-700 rounded w-full"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-4",children:[1,2,3].map(e=>(0,a.jsx)("div",{className:"h-48 bg-slate-200 dark:bg-slate-700 rounded"},e))})]})}):p?(0,a.jsxs)("div",{className:"panel p-8",children:[(0,a.jsx)("div",{className:"text-red-500",children:"Ошибка загрузки шаблонов"}),(0,a.jsx)("button",{onClick:()=>e.back(),className:"mt-4 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90",children:"Назад"})]}):(0,a.jsxs)("div",{className:"panel p-8",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("button",{onClick:()=>e.back(),className:"mb-4 text-sm text-muted-foreground hover:text-foreground",children:"← Назад"}),(0,a.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Галерея шаблонов"}),(0,a.jsxs)("div",{className:"flex gap-4 mb-4",children:[(0,a.jsx)("input",{type:"text",placeholder:"Поиск шаблонов...",value:t,onChange:e=>r(e.target.value),className:"flex-1 rounded-lg border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-primary"}),(0,a.jsx)("select",{value:u,onChange:e=>d(e.target.value),className:"rounded-lg border border-border bg-background px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-primary",children:i.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]})]}),0===g.length?(0,a.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:t||"Все"!==u?"Шаблоны не найдены":"Нет доступных шаблонов"}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:g.map(t=>(0,a.jsx)(c,{template:t,onSelect:()=>e.push("/cabinet/bots/new?templateId=".concat(t.id))},t.id))})]})}function c(e){let{template:t,onSelect:r}=e;return(0,a.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("div",{className:"text-lg font-medium mb-1",children:t.title}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:t.industry})]}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:t.shortDescription}),t.tags.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-1 mb-3",children:t.tags.slice(0,3).map((e,t)=>(0,a.jsx)("span",{className:"text-xs px-2 py-1 bg-slate-100 dark:bg-slate-700 rounded",children:e},t))}),(0,a.jsx)("button",{onClick:r,className:"w-full px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 text-sm",children:"Выбрать"})]})}},97613:(e,t,r)=>{Promise.resolve().then(r.bind(r,97527))}},e=>{e.O(0,[305,163,883,765,337,358],()=>e(e.s=97613)),_N_E=e.O()}]);