(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[643],{16144:(e,t,r)=>{"use strict";r.d(t,{CK:()=>f,D6:()=>h,FO:()=>c,HP:()=>y,JD:()=>g,Kj:()=>b,Lu:()=>d,SJ:()=>m,qf:()=>u,w1:()=>x});var n=r(13305);let s="/api/core",a=null,i=n.Ik({user:n.Ik({telegramUserId:n.ai(),username:n.Yj().nullable().optional(),firstName:n.Yj().nullable().optional(),lastName:n.Yj().nullable().optional(),photoUrl:n.Yj().nullable().optional()}),bots:n.YO(n.Ik({botId:n.Yj(),name:n.Yj(),role:n.Yj()})),csrfToken:n.Yj()});async function l(e,t){let r="undefined"!=typeof AbortController?new AbortController:null,n=r?setTimeout(()=>r.abort(),3e3):null;try{let s=await fetch(e,{...t,signal:null==r?void 0:r.signal,credentials:"include",headers:{"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}},cache:"no-store"});n&&clearTimeout(n);let i=await s.json().catch(()=>({}));if(!s.ok){let e=(null==i?void 0:i.message)||"Ошибка запроса",t=(null==i?void 0:i.code)||"request_failed";if("proxy_misconfigured"===t||e.includes("CORE_API_ORIGIN"))e="CORE_API_ORIGIN не настроен. Проверьте переменные окружения в Railway.";else if("misconfigured"===t&&e.includes("Owner auth is not configured")){let t=e.match(/missing ([^,]+(?:, [^,]+)*)/);e=t?"Owner auth не настроен: отсутствуют ".concat(t[1],". Проверьте переменные окружения в сервисе core."):"Owner auth не настроен. Проверьте JWT_SECRET и TELEGRAM_BOT_TOKEN в сервисе core."}if("csrf_failed"===t||"csrf_token_mismatch"===t){a=null;try{a=(await u()).csrfToken||null,e="CSRF токен обновлен. Попробуйте еще раз."}catch(t){e="Ошибка CSRF токена. Обновите страницу."}}else(401===s.status||403===s.status)&&("unauthorized"===t||"invalid_telegram_auth"===t)&&(e=e||"Требуется авторизация. Войдите через Telegram.");throw{code:t,message:e,request_id:null==i?void 0:i.request_id,details:null==i?void 0:i.details}}return i}catch(e){if(n&&clearTimeout(n),(null==e?void 0:e.name)==="AbortError")throw{code:"timeout",message:"Request timeout (3000ms)"};throw e}}function o(e){return e.startsWith("/api/core/")?e:e.startsWith("/api/")?e.replace(/^\/api\//,"/api/core/"):e.startsWith("/")?"".concat(s).concat(e):"".concat(s,"/").concat(e)}function c(e){return l(o("/api/owner/auth/telegram"),{method:"POST",body:JSON.stringify(e)})}function d(e,t){return l(o("/api/owner/auth/botlink"),{method:"POST",body:JSON.stringify({token:e,...t?{next:t}:{}})})}async function u(){let e=await l(o("/api/owner/auth/me")),t=i.parse(e);return a=t.csrfToken,t}function m(){return l(o("/api/owner/auth/logout"),{method:"POST"})}async function p(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(a&&!e)return a;try{return a=(await u()).csrfToken||null}catch(e){return a=null,null}}async function f(e,t){let r=(null==t?void 0:t.method)||"GET",n={};if("GET"!==r){let e=(null==t?void 0:t.csrfToken)||await p();e&&(n["x-csrf-token"]=e)}return l(o(e),{method:r,headers:n,body:(null==t?void 0:t.body)!==void 0?JSON.stringify(t.body):void 0})}async function x(){return l(o("/api/owner/summary"))}async function b(){return l(o("/api/owner/bots"))}async function h(e){return console.log(JSON.stringify({action:"owner_deactivate_bot",botId:e,timestamp:new Date().toISOString()})),await p(),f("/api/owner/bots/".concat(e),{method:"DELETE"})}async function g(){return f("/api/owner/templates")}async function y(e){return f("/api/owner/bots",{method:"POST",body:e})}},16851:(e,t,r)=>{"use strict";r.d(t,{E:()=>a});var n=r(33931),s=r(36669);function a(e){let{className:t,...r}=e;return(0,n.jsx)("div",{className:(0,s.cn)("animate-pulse rounded-md bg-slate-200 dark:bg-slate-800",t),...r})}},36669:(e,t,r)=>{"use strict";r.d(t,{cn:()=>a});var n=r(73682),s=r(72454);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,n.$)(t))}},57023:(e,t,r)=>{"use strict";r.d(t,{E:()=>a});var n=r(33931),s=r(36669);function a(e){let{variant:t="default",children:r,className:a}=e;return(0,n.jsx)("span",{className:(0,s.cn)("inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium",{"bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-200":"default"===t,"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"success"===t,"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200":"warning"===t,"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200":"danger"===t,"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"info"===t},a),children:r})}},65940:(e,t,r)=>{"use strict";r.d(t,{R:()=>n});let n={common:{loading:"Загрузка...",error:"Ошибка",save:"Сохранить",cancel:"Отмена",delete:"Удалить",edit:"Редактировать",create:"Создать",search:"Поиск",filter:"Фильтр",clear:"Очистить",apply:"Применить",close:"Закрыть",back:"Назад",next:"Далее",previous:"Назад",refresh:"Обновить",export:"Экспорт",import:"Импорт"},nav:{bots:"Мои боты",overview:"Обзор",inbox:"Входящие",calendar:"Календарь",orders:"Заказы",leads:"Лиды",customers:"Клиенты",team:"Команда",settings:"Настройки",audit:"Аудит"},roles:{owner:"Владелец",admin:"Администратор",staff:"Сотрудник",viewer:"Наблюдатель"},bot:{selectBot:"Выберите бота",switchBot:"Переключить бота",noBots:"Нет доступных ботов",context:"Контекст",role:"Роль"},inbox:{title:"Входящие",new:"Новые",inProgress:"В работе",done:"Выполнено",cancelled:"Отменено",unassigned:"Не назначено",assignToMe:"Назначить мне",markAsDone:"Отметить выполненным",createOrder:"Создать заказ",createLead:"Создать лид",createAppointment:"Создать запись",empty:"Нет событий",emptyDesc:"Все события будут отображаться здесь"},orders:{title:"Заказы",new:"Новые",processing:"В обработке",completed:"Завершено",cancelled:"Отменено",empty:"Нет заказов",emptyDesc:"Заказы будут отображаться здесь"},leads:{title:"Лиды",new:"Новые",contacted:"Связались",qualified:"Квалифицированы",converted:"Конвертированы",lost:"Потеряны",empty:"Нет лидов",emptyDesc:"Лиды будут отображаться здесь"},customers:{title:"Клиенты",empty:"Нет клиентов",emptyDesc:"Клиенты будут отображаться здесь"},calendar:{title:"Календарь",empty:"Нет записей",emptyDesc:"Записи будут отображаться здесь"},team:{title:"Команда",addMember:"Добавить участника",empty:"Нет участников",emptyDesc:"Добавьте участников команды"},settings:{title:"Настройки",general:"Общие",notifications:"Уведомления",integrations:"Интеграции"},audit:{title:"Аудит",empty:"Нет записей",emptyDesc:"История изменений будет отображаться здесь"},errors:{notFound:"Не найдено",unauthorized:"Требуется авторизация",forbidden:"Доступ запрещен",serverError:"Ошибка сервера",networkError:"Ошибка сети",unknown:"Неизвестная ошибка",requestId:"ID запроса",details:"Подробнее"},dashboard:{title:"Обзор",kpi:{newLeads:"Новые лиды",orders:"Заказы",revenue:"Выручка",conversion:"Конверсия"},trends:"Тренды",recent:"Недавние"}}},69646:(e,t,r)=>{"use strict";r.d(t,{p:()=>i});var n=r(33931),s=r(36669);let a=(0,r(51259).forwardRef)((e,t)=>{let{className:r,variant:a="primary",size:i="md",...l}=e;return(0,n.jsx)("button",{ref:t,className:(0,s.cn)("inline-flex items-center justify-center rounded-lg font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary disabled:pointer-events-none disabled:opacity-50",{"bg-primary text-white hover:bg-primary/90":"primary"===a,"bg-slate-100 text-slate-900 hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-100 dark:hover:bg-slate-700":"secondary"===a,"hover:bg-slate-100 dark:hover:bg-slate-800":"ghost"===a,"bg-red-500 text-white hover:bg-red-600":"danger"===a,"h-8 px-3 text-sm":"sm"===i,"h-10 px-4 text-sm":"md"===i,"h-12 px-6 text-base":"lg"===i},r),...l})});function i(e){let{title:t,description:r,action:s,icon:i}=e;return(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[i&&(0,n.jsx)("div",{className:"mb-4 text-6xl opacity-50",children:i}),(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:t}),r&&(0,n.jsx)("p",{className:"text-sm text-muted-foreground mb-6 max-w-md text-center",children:r}),s&&(0,n.jsx)(a,{onClick:s.onClick,variant:"primary",children:s.label})]})}a.displayName="Button"},80194:(e,t,r)=>{Promise.resolve().then(r.bind(r,96562))},96562:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var n=r(33931),s=r(30883),a=r(16144),i=r(86804),l=r(16851),o=r(69646),c=r(65940),d=r(57023),u=r(51259);function m(){let e=(0,i.useParams)().botId,[t,r]=(0,u.useState)("new"),{data:m,isLoading:p,error:f}=(0,s.I)({queryKey:["inbox",e,t],queryFn:()=>(0,a.CK)("/api/owner/bots/".concat(e,"/events?status=").concat(t,"&limit=50"))});if(p)return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(l.E,{className:"h-12 w-full"}),(0,n.jsx)(l.E,{className:"h-64 w-full"})]});if(f)return(0,n.jsx)(o.p,{title:c.R.errors.serverError,description:"Не удалось загрузить входящие"});let x=(null==m?void 0:m.items)||[];return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold",children:c.R.inbox.title}),(0,n.jsx)("div",{className:"flex gap-2",children:["new","in_progress","done","cancelled"].map(e=>(0,n.jsx)("button",{onClick:()=>r(e),className:"px-3 py-1 rounded text-sm ".concat(t===e?"bg-primary text-white":"bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700"),children:c.R.inbox[e]||e},e))})]}),0===x.length?(0,n.jsx)(o.p,{title:c.R.inbox.empty,description:c.R.inbox.emptyDesc}):(0,n.jsx)("div",{className:"panel",children:(0,n.jsx)("div",{className:"divide-y divide-border",children:x.map(e=>{var t;return(0,n.jsx)("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:(0,n.jsx)("div",{className:"flex items-start justify-between",children:(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,n.jsx)(d.E,{variant:"new"===e.status?"info":"done"===e.status?"success":"default",children:e.status}),(0,n.jsx)("span",{className:"text-sm text-muted-foreground",children:e.type})]}),(0,n.jsx)("div",{className:"text-sm",children:(null==(t=e.payload)?void 0:t.text)||JSON.stringify(e.payload)}),(0,n.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:new Date(e.createdAt).toLocaleString("ru-RU")})]})})},e.id)})})})]})}}},e=>{e.O(0,[305,163,883,844,765,337,358],()=>e(e.s=80194)),_N_E=e.O()}]);