(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[856],{16144:(e,t,s)=>{"use strict";s.d(t,{CK:()=>p,D6:()=>b,FO:()=>c,Kj:()=>v,Lu:()=>d,SJ:()=>m,qf:()=>u,w1:()=>x});var n=s(13305);let r="/api/core",a=null,i=n.Ik({user:n.Ik({telegramUserId:n.ai(),username:n.Yj().nullable().optional(),firstName:n.Yj().nullable().optional(),lastName:n.Yj().nullable().optional(),photoUrl:n.Yj().nullable().optional()}),bots:n.YO(n.Ik({botId:n.Yj(),name:n.Yj(),role:n.Yj()})),csrfToken:n.Yj()});async function l(e,t){let s="undefined"!=typeof AbortController?new AbortController:null,n=s?setTimeout(()=>s.abort(),3e3):null;try{let r=await fetch(e,{...t,signal:null==s?void 0:s.signal,credentials:"include",headers:{"Content-Type":"application/json",...(null==t?void 0:t.headers)||{}},cache:"no-store"});n&&clearTimeout(n);let a=await r.json().catch(()=>({}));if(!r.ok)throw{code:(null==a?void 0:a.code)||"request_failed",message:(null==a?void 0:a.message)||"Ошибка запроса",request_id:null==a?void 0:a.request_id,details:null==a?void 0:a.details};return a}catch(e){if(n&&clearTimeout(n),(null==e?void 0:e.name)==="AbortError")throw{code:"timeout",message:"Request timeout (3000ms)"};throw e}}function o(e){return e.startsWith("/api/core/")?e:e.startsWith("/api/")?e.replace(/^\/api\//,"/api/core/"):e.startsWith("/")?"".concat(r).concat(e):"".concat(r,"/").concat(e)}function c(e){return l(o("/api/owner/auth/telegram"),{method:"POST",body:JSON.stringify(e)})}function d(e){return l(o("/api/owner/auth/botlink"),{method:"POST",body:JSON.stringify({token:e})})}async function u(){let e=await l(o("/api/owner/auth/me")),t=i.parse(e);return a=t.csrfToken,t}function m(){return l(o("/api/owner/auth/logout"),{method:"POST"})}async function h(){if(a)return a;try{return(await u()).csrfToken||null}catch(e){return null}}async function p(e,t){let s=(null==t?void 0:t.method)||"GET",n={};if("GET"!==s){let e=(null==t?void 0:t.csrfToken)||await h();e&&(n["x-csrf-token"]=e)}return l(o(e),{method:s,headers:n,body:(null==t?void 0:t.body)!==void 0?JSON.stringify(t.body):void 0})}async function x(){return l(o("/api/owner/summary"))}async function v(){return l(o("/api/owner/bots"))}async function b(e){return l(o("/api/owner/bots/".concat(e)),{method:"DELETE"})}},39286:(e,t,s)=>{Promise.resolve().then(s.bind(s,65080))},65080:(e,t,s)=>{"use strict";s.d(t,{OwnerSection:()=>h});var n=s(33931),r=s(16144),a=s(30883),i=s(29793),l=s(20232),o=s(80444),c=s(33679),d=s(45166),u=s(3221);function m(e){let{rows:t}=e;if(!t.length)return(0,n.jsxs)("div",{className:"panel p-8 text-center",children:[(0,n.jsx)("div",{className:"text-lg font-medium",children:"Пока пусто"}),(0,n.jsx)("div",{className:"muted text-sm mt-1",children:"Как только появятся события, они будут отображаться здесь."})]});let s=Object.keys(t[0]).slice(0,8);return(0,n.jsx)("div",{className:"panel overflow-auto",children:(0,n.jsxs)("table",{className:"w-full text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{className:"border-b border-border",children:s.map(e=>(0,n.jsx)("th",{className:"px-3 py-2 text-left font-medium",children:e},e))})}),(0,n.jsx)("tbody",{children:t.map((e,t)=>(0,n.jsx)("tr",{className:"border-b border-border/60 hover:bg-slate-50 dark:hover:bg-slate-900/40",children:s.map(t=>{var s;return(0,n.jsx)("td",{className:"px-3 py-2 align-top",children:"object"==typeof e[t]?JSON.stringify(e[t]):String(null!=(s=e[t])?s:"")},t)})},t))})]})})}function h(e){let{botId:t,section:s}=e,h="overview"===s?"/api/owner/bots/".concat(t,"/events/summary"):"inbox"===s?"/api/owner/bots/".concat(t,"/events?limit=100"):"calendar"===s?"/api/owner/bots/".concat(t,"/appointments"):"orders"===s?"/api/owner/bots/".concat(t,"/orders?limit=100"):"leads"===s?"/api/owner/bots/".concat(t,"/leads?limit=100"):"customers"===s?"/api/owner/bots/".concat(t,"/customers?limit=100"):"team"===s?"/api/owner/bots/".concat(t,"/team"):"settings"===s?"/api/owner/bots/".concat(t):"/api/owner/bots/".concat(t,"/audit?limit=100"),{data:p,isLoading:x,error:v}=(0,a.I)({queryKey:["owner-section",t,s],queryFn:()=>(0,r.CK)(h)});if(x)return(0,n.jsx)("div",{className:"panel p-8",children:"Загрузка данных..."});if(v)return(0,n.jsxs)("div",{className:"panel p-8",children:[(0,n.jsx)("div",{className:"text-red-500 font-medium",children:"Ошибка загрузки"}),(0,n.jsx)("div",{className:"text-sm muted mt-1",children:(null==v?void 0:v.message)||"Неизвестная ошибка"}),(0,n.jsxs)("div",{className:"text-xs muted mt-1",children:["request_id: ",(null==v?void 0:v.request_id)||"n/a"]})]});if("overview"===s){let e=Object.entries((null==p?void 0:p.byType)||{}).map(e=>{let[t,s]=e;return{name:t,value:s}});return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,n.jsxs)("div",{className:"panel p-4",children:[(0,n.jsx)("div",{className:"text-sm muted",children:"Всего событий"}),(0,n.jsx)("div",{className:"text-3xl font-semibold mt-1",children:(null==p?void 0:p.total)||0})]}),Object.entries((null==p?void 0:p.byStatus)||{}).map(e=>{let[t,s]=e;return(0,n.jsxs)("div",{className:"panel p-4",children:[(0,n.jsxs)("div",{className:"text-sm muted",children:["Статус: ",t]}),(0,n.jsx)("div",{className:"text-3xl font-semibold mt-1",children:s})]},t)})]}),(0,n.jsxs)("div",{className:"panel p-4",children:[(0,n.jsx)("div",{className:"font-medium mb-3",children:"События по типам"}),(0,n.jsx)("div",{className:"h-[280px]",children:(0,n.jsx)(i.u,{width:"100%",height:"100%",children:(0,n.jsxs)(l.E,{data:e,children:[(0,n.jsx)(o.W,{dataKey:"name"}),(0,n.jsx)(c.h,{}),(0,n.jsx)(d.m,{}),(0,n.jsx)(u.y,{dataKey:"value",fill:"hsl(var(--primary))",radius:6})]})})})]})]})}let b=Array.isArray(null==p?void 0:p.items)?p.items:Array.isArray(p)?p:p?[p]:[];return(0,n.jsx)(m,{rows:b})}}},e=>{e.O(0,[305,251,883,290,765,337,358],()=>e(e.s=39286)),_N_E=e.O()}]);